# BTLO Follina

## Senario

<img width="1151" height="219" alt="image" src="https://github.com/user-attachments/assets/6a13867d-9548-474a-8215-ba93f68b4388" />



## Overview
In this lab, I analyzed a malicious Word document that used the Follina (CVE-2022-30190) exploit. After extracting the files, I found the embedded URL inside document.xml.rels. This Word document attempts to launch mtdt.exe to gain access to the computer and execute malicious PowerShell code. I completed my investigation to identify the correct MITRE technique and verify the associated CVE.

## Tools Used
- Notepad ++
- Virus Total
- 7 Zip

## Question 1) What is the SHA1 hash value of the sample? 
In this lab, I investigated a malicious Word document. My first task was to obtain the file’s SHA-1 hash value, which I gathered using PowerShell.

I used a PowerShell command to retrieve the file’s hash value.

```Get-fileHash "C:\Users\iman\Desktop\43eecf22e8f914d44df3da16c23dcc2e076a8753\sample\sample.doc" -Alogrithm SHA1 >```

<img width="1920" height="1080" alt="image" src="https://github.com/user-attachments/assets/06a69c40-a026-4bff-b312-a19e823d496a" />

## Question 2) According to VirusTotal, what is the full filetype of the provided sample?
I used VirusTotal to identify the full file type of the malicious document. The file type was listed as “Office Open XML Document.”

<img width="1920" height="1080" alt="image" src="https://github.com/user-attachments/assets/eea2f2aa-292c-42db-a2c0-6f9332886644" />

## Question 3) Extract the URL that is used within the sample and submit it
I used Notepad++ to identify the malicious URL within the document.

### URL
- https://www.xmlformats.com/office/word/2022/wordprocessingDrawing/RDF842l.html

### Why is this  Malicious?
The URL is malicious because it attempts to load an external website, which is not typical behavior for a normal Word document. The domain itself is also fake—the attacker tried to make it appear as though it belonged to Microsoft.

<img width="1920" height="1080" alt="image" src="https://github.com/user-attachments/assets/1549a36d-005e-4ea2-b813-a3f5916c470f" />

## Question 4) What is the name of the XML file that is storing the extracted URL?
To find the name of the XML file, I renamed sample.doc to sample.zip and extracted it.

Pathway - Word/_rels/######.XML file

## Question 5) The extracted URL accesses a HTML file that triggers the vulnerability to execute a malicious payload. According to the HTML processing functions, any files with fewer than <Number> bytes would not invoke the payload. Submit the <Number> 

At first, I tried accessing the URL, but it was no longer working. I used ChatGPT to better understand what was happening behind the scenes. I then extracted the remote HTML file used by the malicious document. The exploit only works if the HTML file meets a minimum size requirement—if the file is smaller than this threshold, the payload will not execute.

## Question 6) After execution, the sample will try to kill a process if it is already running. What is the name of this process? (Format: filename.ext) 

The malware uses msdt.exe to execute its malicious code. After it runs, the malware checks whether msdt.exe is still active, and if it is, the malware terminates it.

### Why?
Because the attacker doesn’t want msdt.exe to remain open—since it could look suspicious to a user or a defender—the malware attempts to terminate it after execution.

## Question 7) You were asked to write a process-based detection rule using Windows Event ID 4688. What would be the ProcessName and ParentProcessname used in this detection rule? 

Windows event ID 4688 indicates that a new process was created. In this case, the ParentProcessName is Microsoft Word, and the ProcessName is msdt.exe. This is abnormal behavior because a Word document should not be launching msdt.exe.

## Question 8) Submit the MITRE technique ID used by the sample for Execution 

T1559 is used when malware abuses one Windows process to trigger another process.

In the Follina exploit:
- WINWORD.EXE loads the malicious HTML file.
- The HTML forces Word to call msdt.exe.
- msdt.exe then executes the malicious command.

## Question 9) Submit the CVE associated with the vulnerability that is being exploited
I Found the answer using Virus Total.

<img width="1920" height="1080" alt="image" src="https://github.com/user-attachments/assets/95fc6668-34c2-4360-8abd-d9bce48c5b23" />

## Conclusion

This lab helped me understand how malicious Word documents can abuse trusted Windows processes to execute code. By extracting and analyzing the document contents, I learned how to identify hidden URLs, understand how the Follina exploit works, and verify indicators using tools like VirusTotal and PowerShell. Writing a process-based detection rule using Windows Event ID 4688 also helped me think from a SOC analyst perspective and understand how this type of activity could be detected in real environments.
